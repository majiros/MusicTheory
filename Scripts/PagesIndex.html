<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MusicTheory Coverage & Links</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; margin: 2rem; line-height: 1.6; }
      h1 { margin-bottom: .25rem; }
      .muted { color: #666; font-size: .95rem; }
      ul { margin-top: .5rem; }
      a { color: #0969da; text-decoration: none; }
      a:hover { text-decoration: underline; }
      .badge { display:inline-block; vertical-align:middle; margin-right:.5rem; }
      .cov-text { margin-right: .75rem; }
      .gen-on { margin-left: .75rem; }
    </style>
  </head>
  <body>
    <h1>MusicTheory</h1>
  <div class="muted">Coverage report and helpful links</div>

    <p>
  <span class="badge"><img alt="coverage" src="./coverage/badge_linecoverage.svg" /></span>
      <strong id="cov-text" class="muted cov-text"></strong>
      <a href="./coverage/index.html">Open Coverage Report</a>
  <span id="gen-on" class="muted gen-on"></span>
    </p>

    <h2>Links</h2>
    <ul>
      <li><a href="https://github.com/majiros/MusicTheory">GitHub Repository</a></li>
      <li><a href="https://github.com/majiros/MusicTheory/blob/main/README.md">README.md</a></li>
      <li><a href="https://github.com/majiros/MusicTheory/blob/main/Docs/UserGuide.md">Docs/UserGuide.md</a></li>
      <li><a href="https://github.com/majiros/MusicTheory/actions/workflows/coverage-pages.yml">coverage-pages workflow</a></li>
    </ul>

    <hr />
    <p class="muted">This page is published by GitHub Pages from the latest coverage artifact.</p>

    <script>
      (function () {
        const target = document.getElementById('cov-text');
        if (!target) return;
        // Try to fetch Summary.xml generated by ReportGenerator (XmlSummary)
        // Add a cache-busting query to mitigate CDN caching on Pages
        const summaryUrl = `./coverage/Summary.xml?v=${Date.now()}`;
        fetch(summaryUrl, { cache: 'no-store' })
          .then(r => r.ok ? r.text() : Promise.reject(new Error('404')))
          .then(txt => {
            const parser = new DOMParser();
            const xml = parser.parseFromString(txt, 'application/xml');
            const line = xml.querySelector('CoverageReport > Summary > Linecoverage');
            const branch = xml.querySelector('CoverageReport > Summary > Branchcoverage');
            const method = xml.querySelector('CoverageReport > Summary > Methodcoverage');
            const gen = xml.querySelector('CoverageReport > Summary > Generatedon');
            const parts = [];
            if (line && line.textContent) parts.push(`Line ${Number(line.textContent).toFixed(1)}%`);
            if (branch && branch.textContent) parts.push(`Branch ${Number(branch.textContent).toFixed(1)}%`);
            if (method && method.textContent) parts.push(`Method ${Number(method.textContent).toFixed(1)}%`);
            if (parts.length) {
              target.textContent = parts.join(' â€¢ ');
              target.classList.remove('muted');
            }
            if (gen && gen.textContent) {
              const txt = `Generated on: ${gen.textContent} (UTC)`;
              target.title = txt;
              const genEl = document.getElementById('gen-on');
              if (genEl) genEl.textContent = `(${txt})`;
            }
          })
          .catch(() => { /* no-op: keep badge-only view */ });
      })();
    </script>
  </body>
  </html>
